<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>K·∫øt Qu·∫£ Ph·ªèng V·∫•n Medic</title>
  <style>
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background: radial-gradient(circle at top, #0f0c29, #302b63, #24243e);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
    }
    .container {
      position: relative;
      z-index: 10;
      width: 90%;
      max-width: 800px;
      padding: 30px;
      background: rgba(0,0,0,0.6);
      border-radius: 20px;
      box-shadow: 0 0 25px #00f5ff, 0 0 50px #ff00ff;
      text-align: center;
    }
    h1 {
      font-size: 2em;
      background: linear-gradient(90deg, #00f5ff, #ff00ff, #00ff9d);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: glow 3s infinite alternate;
    }
    @keyframes glow {
      from { text-shadow: 0 0 10px #00f5ff; }
      to   { text-shadow: 0 0 30px #ff00ff; }
    }
    .info {
      text-align: left;
      margin: 20px 0;
      padding: 20px;
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
    }
    .result {
      font-size: 1.4em;
      margin: 20px 0;
      padding: 15px;
      border-radius: 12px;
      font-weight: bold;
    }
    .pass {
      background: rgba(0,255,150,0.2);
      color: #00ff9d;
      box-shadow: 0 0 20px #00ff9d;
    }
    .fail {
      background: rgba(255,0,80,0.2);
      color: #ff4b2b;
      box-shadow: 0 0 20px #ff4b2b;
    }
    button {
      margin-top: 20px;
      padding: 12px 35px;
      font-size: 1.1em;
      border: none;
      border-radius: 50px;
      background: linear-gradient(45deg, #00f5ff, #ff00ff, #00ff9d);
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px #fff, 0 0 40px #ff00ff;
    }
    canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <canvas id="fireworks"></canvas>
  <div class="container">
    <h1>üìä K·∫øt Qu·∫£ Ph·ªèng V·∫•n Medic </h1>
    <div id="candidateInfo" class="info"></div>
    <div id="scoreResult" class="result"></div>
    <button onclick="window.location.href='index.html'">üîÑ L√†m l·∫°i b√†i test</button>
  </div>

  <!-- √Çm thanh ph√°o hoa -->
  <audio id="fireworkSound" src="https://files.catbox.moe/jy7694.mp3" preload="auto"></audio>

  <script>
    const data = JSON.parse(localStorage.getItem("quizResult"));
    const totalQuestions = 25; // s·ªë c√¢u tr·∫Øc nghi·ªám

    const infoBox = document.getElementById("candidateInfo");
    const resultBox = document.getElementById("scoreResult");
    const fireworkCanvas = document.getElementById("fireworks");
    const ctx = fireworkCanvas.getContext("2d");
    fireworkCanvas.width = window.innerWidth;
    fireworkCanvas.height = window.innerHeight;

    if (!data) {
      infoBox.innerHTML = "<p>‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu. Vui l√≤ng l√†m l·∫°i b√†i test.</p>";
    } else {
      // T·ªïng ƒëi·ªÉm = ƒëi·ªÉm tr·∫Øc nghi·ªám + ƒëi·ªÉm t√¨nh hu·ªëng
      const totalScore = (data.score || 0) + (data.scenarioScore || 0);

      infoBox.innerHTML = `
        <p><b>üë§ IC Name:</b> ${data.icName}</p>
        <p><b>üåê OOC Name:</b> ${data.oocName}</p>
        <p><b>üéÇ Tu·ªïi:</b> ${data.age}</p>
        <p><b>‚öß Gi·ªõi t√≠nh:</b> ${data.gender}</p>
        <p><b>üí¨ Discord:</b> ${data.discord}</p>
        <p><b>üìñ Kinh nghi·ªám:</b> ${data.exp || "Kh√¥ng c√≥"}</p>
        <p><b>‚úÖ C√¢u tr·∫Øc nghi·ªám ƒë√∫ng:</b> ${data.correctCount}/${totalQuestions}</p>
        <p><b>üìù ƒêi·ªÉm t√¨nh hu·ªëng:</b> ${data.scenarioScore || 0}</p>
        <p><b>‚≠ê T·ªïng ƒëi·ªÉm:</b> ${totalScore}</p>
      `;

      const passScore = 25; 
      if (totalScore >= passScore) {
        resultBox.className = "result pass";
        resultBox.textContent = `üéâ Ch√∫c m·ª´ng ${data.icName}! B·∫°n ƒë√£ ƒê·∫¨U v·ªõi ${totalScore} ƒëi·ªÉm.`;
        startFireworks();
        document.getElementById("fireworkSound").play();
      } else {
        resultBox.className = "result fail";
        resultBox.textContent = `üò¢ R·∫•t ti·∫øc ${data.icName}! B·∫°n ch·ªâ ƒë·∫°t ${totalScore} ƒëi·ªÉm.`;
      }
    }

    // ===================== PH√ÅO HOA =====================
    class Firework {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.radius = 2;
        this.particles = [];
        for (let i = 0; i < 80; i++) {
          const angle = Math.random() * 2 * Math.PI;
          const speed = Math.random() * 5 + 2;
          this.particles.push({
            x: this.x,
            y: this.y,
            dx: Math.cos(angle) * speed,
            dy: Math.sin(angle) * speed,
            life: 100
          });
        }
      }
      draw() {
        this.particles.forEach(p => {
          ctx.beginPath();
          ctx.arc(p.x, p.y, this.radius, 0, Math.PI * 2);
          ctx.fillStyle = this.color;
          ctx.fill();
        });
      }
      update() {
        this.particles.forEach(p => {
          p.x += p.dx;
          p.y += p.dy;
          p.dy += 0.05; 
          p.life -= 1;
        });
        this.particles = this.particles.filter(p => p.life > 0);
      }
    }

    let fireworks = [];
    function startFireworks() {
      animate(); // fix l·ªói kh√¥ng b·∫Øn
      setInterval(() => {
        const x = Math.random() * fireworkCanvas.width;
        const y = Math.random() * fireworkCanvas.height / 2;
        const colors = ["#ff4b2b", "#00ff9d", "#00f5ff", "#ff00ff", "#ffff00"];
        fireworks.push(new Firework(x, y, colors[Math.floor(Math.random()*colors.length)]));
      }, 700);
    }

    function animate() {
      ctx.fillStyle = "rgba(0,0,0,0.2)";
      ctx.fillRect(0, 0, fireworkCanvas.width, fireworkCanvas.height);
      fireworks.forEach(f => {
        f.update();
        f.draw();
      });
      fireworks = fireworks.filter(f => f.particles.length > 0);
      requestAnimationFrame(animate);
    }

    window.addEventListener("resize", () => {
      fireworkCanvas.width = window.innerWidth;
      fireworkCanvas.height = window.innerHeight;
    });
  </script>
</body>
  </html>
