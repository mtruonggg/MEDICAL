<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>K·∫øt Qu·∫£ B√†i Test Medic RP</title>
<style>
  body {
    margin: 0;
    font-family: "Poppins", sans-serif;
    background: radial-gradient(circle at top, #0f0c29, #302b63, #24243e);
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    overflow: hidden;
  }
  canvas {
    position: fixed;
    top: 0;
    left: 0;
    z-index: 0;
  }
  .container {
    width: 90%;
    max-width: 800px;
    padding: 30px;
    background: rgba(0,0,0,0.6);
    border-radius: 20px;
    box-shadow: 0 0 25px #00f5ff, 0 0 50px #ff00ff;
    text-align: center;
    position: relative;
    z-index: 1;
  }
  h1 {
    font-size: 2.2em;
    background: linear-gradient(90deg, #00f5ff, #ff00ff, #00ff9d);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: glow 3s infinite alternate;
  }
  @keyframes glow {
    from { text-shadow: 0 0 10px #00f5ff; }
    to   { text-shadow: 0 0 30px #ff00ff; }
  }
  .info {
    text-align: left;
    margin: 20px 0;
    padding: 20px;
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
    font-size: 1.1em;
    line-height: 1.6em;
  }
  .info p { margin: 6px 0; }
  .result {
    font-size: 1.5em;
    margin: 20px 0;
    padding: 15px;
    border-radius: 12px;
    font-weight: bold;
  }
  .pass {
    background: rgba(0,255,150,0.2);
    color: #00ff9d;
    box-shadow: 0 0 20px #00ff9d;
  }
  .fail {
    background: rgba(255,0,80,0.2);
    color: #ff4b2b;
    box-shadow: 0 0 20px #ff4b2b;
  }
  button {
    margin-top: 20px;
    padding: 12px 35px;
    font-size: 1.1em;
    border: none;
    border-radius: 50px;
    background: linear-gradient(45deg, #00f5ff, #ff00ff, #00ff9d);
    color: white;
    cursor: pointer;
    transition: all 0.3s;
  }
  button:hover {
    transform: scale(1.1);
    box-shadow: 0 0 20px #fff, 0 0 40px #ff00ff;
  }

  /* Popup ƒëi·ªÉm tuy·ªát ƒë·ªëi */
  .popup {
    position: fixed;
    top: 20%;
    left: 50%;
    transform: translateX(-50%);
    font-size: 3em;
    font-weight: bold;
    background: linear-gradient(90deg, #ff00cc, #3333ff, #00ffcc);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 15px #ff00ff, 0 0 25px #00ffff;
    white-space: nowrap;
    z-index: 1000;
    opacity: 0;
    animation: slideIn 6s linear forwards;
  }
  @keyframes slideIn {
    0% { transform: translateX(-100%) scale(0.8); opacity: 0; }
    20% { opacity: 1; }
    50% { transform: translateX(0) scale(1.1); opacity: 1; }
    80% { opacity: 1; }
    100% { transform: translateX(100%) scale(0.8); opacity: 0; }
  }
</style>
</head>
<body>
<canvas id="fireworksCanvas"></canvas>

<!-- √ÇM THANH -->
<audio id="launchSound" src="bbang-47623.mp3"></audio>
<audio id="whistleSound" src="whistlingrocket_2-106971.mp3"></audio>
<audio id="wooshSound" src="woosh-104586.mp3"></audio>
<audio id="explosionBig" src="big-boom-14752.mp3"></audio>
<audio id="explosionCluster" src="firework-cluster-90480.mp3"></audio>
<audio id="awardMusic" src="award.mp3"></audio>

<div class="container">
  <h1>‚öïÔ∏è K·∫æT QU·∫¢ PH·ªéNG V·∫§N MEDIC ‚öïÔ∏è</h1>
  <div id="candidateInfo" class="info"></div>
  <div id="scoreResult" class="result"></div>
  <button onclick="window.location.href='index.html'">üîÑ L√†m l·∫°i b√†i test</button>
</div>

<script>
// ====== Hi·ªÉn th·ªã k·∫øt qu·∫£ ======
const data = JSON.parse(localStorage.getItem("quizResult"));
const totalQuestions = 25; 
const scenarioCount = 5; 
const scenarioPoint = 2; 

if (!data) {
  document.getElementById("candidateInfo").innerHTML = "<p>‚ùå Kh√¥ng c√≥ d·ªØ li·ªáu. Vui l√≤ng l√†m l·∫°i b√†i test.</p>";
} else {
  const scenarioScore = scenarioCount * scenarioPoint;
  const totalScore = data.score + scenarioScore;

  document.getElementById("candidateInfo").innerHTML = `
    <p>üë§ <b>IC Name:</b> ${data.icName}</p>
    <p>üåê <b>OOC Name:</b> ${data.oocName}</p>
    <p>üéÇ <b>Tu·ªïi:</b> ${data.age}</p>
    <p>‚öß <b>Gi·ªõi t√≠nh:</b> ${data.gender}</p>
    <p>üí¨ <b>Discord:</b> ${data.discord}</p>
    <p>üìñ <b>Kinh nghi·ªám:</b> ${data.exp || "Kh√¥ng c√≥"}</p>
    <p>‚úÖ <b>C√¢u tr·∫Øc nghi·ªám ƒë√∫ng:</b> ${data.correctCount}/${totalQuestions} (${questionScore} ƒëi·ªÉm)</p>
    <p>üé≠ <b>T√¨nh hu·ªëng ƒë√∫ng:</b> ${data.scenarioCorrect || 0}/${scenarioCount} (${scenarioScore} ƒëi·ªÉm)</p>
    <p>‚≠ê <b>T·ªïng ƒëi·ªÉm:</b> ${totalScore}/${maxScore}</p>
  `;

  const passScore = 35;
  const resultBox = document.getElementById("scoreResult");

  if (totalScore >= passScore) {
    resultBox.className = "result pass";
    resultBox.textContent = `üéâ Ch√∫c m·ª´ng ${data.icName}! B·∫°n ƒë√£ ƒê·∫¨U v·ªõi ${totalScore}/${maxScore} ƒëi·ªÉm.`;
    startFireworks();

    if (totalScore === maxScore) {
      showPerfectPopup();
      const awardMusic = document.getElementById("awardMusic");
      awardMusic.play().catch(()=>{});
      setTimeout(()=>{
        awardMusic.pause();
        awardMusic.currentTime = 0;
      },15000);
    }
  } else {
    resultBox.className = "result fail";
    resultBox.textContent = `üò¢ R·∫•t ti·∫øc ${data.icName}! B·∫°n ch·ªâ ƒë·∫°t ${totalScore}/${maxScore} ƒëi·ªÉm.`;
  }
}

// ================= FIREWORKS =================
const canvas = document.getElementById("fireworksCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
window.addEventListener("resize", () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

let fireworks = [];
let particles = [];

// ================== √ÇM THANH ==================
function playSound(id) {
  const s = document.getElementById(id);
  if (!s) return;
  const clone = s.cloneNode();
  clone.volume = 0.8;
  clone.play().catch(()=>{});
}

window.addEventListener("load", ()=>{
  ["launchSound","whistleSound","wooshSound","explosionBig","explosionCluster","awardMusic"].forEach(id=>{
    const el=document.getElementById(id);
    if(el) el.load();
  });
});

// ================== FIREWORK ==================
class Firework {
  constructor() {
    this.x = Math.random() * canvas.width;
    this.y = canvas.height;
    this.targetY = Math.random() * (canvas.height/2);
    this.speed = 7 + Math.random()*3;
    this.trail = [];
    this.exploded = false;

    playSound("launchSound");
    playSound("whistleSound");
    playSound("wooshSound");
  }

  update() {
    if (!this.exploded) {
      this.trail.push({x:this.x,y:this.y});
      if(this.trail.length>10) this.trail.shift();
      this.y -= this.speed;

      if (this.y <= this.targetY) {
        this.explode();
        this.exploded = true;
      }
    }
  }

  draw() {
    ctx.beginPath();
    ctx.moveTo(this.x,this.y);
    for(let i=this.trail.length-1;i>=0;i--){
      const p=this.trail[i];
      ctx.lineTo(p.x,p.y);
    }
    ctx.strokeStyle="rgba(255,255,200,0.8)";
    ctx.lineWidth=2;
    ctx.stroke();
  }

  explode() {
    const count = 24+Math.random()*25;
    for(let i=0;i<count;i++){
      setTimeout(()=>{
        particles.push(new Particle(this.x,this.y));
      },i*20);
    }
    if(Math.random()>0.5) playSound("explosionBig");
    else playSound("explosionCluster");
  }
}

// ================== PARTICLE ==================
class Particle {
  constructor(x,y){
    this.x=x; this.y=y;
    this.angle=Math.random()*Math.PI*2;
    this.speed=Math.random()*6+2;
    this.life=1;
    this.decay=Math.random()*0.02+0.015;
    this.size=Math.random()*2+1;

    const colors=[
      ["#ffcc00","#ff3300"],
      ["#66ff66","#33ccff"],
      ["#ff99ff","#cc00ff"],
      ["#ffffff","#ffff99"]
    ];
    this.gradientColors=colors[Math.floor(Math.random()*colors.length)];
  }

  update(){
    this.x+=Math.cos(this.angle)*this.speed;
    this.y+=Math.sin(this.angle)*this.speed+0.2;
    this.speed*=0.97;
    this.life-=this.decay;
  }

  draw(){
    if(this.life<=0) return;
    ctx.globalAlpha=this.life;
    const gradient=ctx.createLinearGradient(
      this.x,this.y,
      this.x-Math.cos(this.angle)*this.size*8,
      this.y-Math.sin(this.angle)*this.size*8
    );
    gradient.addColorStop(0,"#fff");
    gradient.addColorStop(0.3,this.gradientColors[0]);
    gradient.addColorStop(1,this.gradientColors[1]);

    ctx.strokeStyle=gradient;
    ctx.lineWidth=this.size;
    ctx.beginPath();
    ctx.moveTo(this.x,this.y);
    ctx.lineTo(
      this.x-Math.cos(this.angle)*this.size*8,
      this.y-Math.sin(this.angle)*this.size*8
    );
    ctx.stroke();
    ctx.globalAlpha=1;
  }
}

// ================== LOOP ==================
function animate(){
  ctx.fillStyle="rgba(0,0,0,0.2)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  fireworks.forEach((fw,i)=>{
    fw.update(); fw.draw();
    if(fw.exploded) fireworks.splice(i,1);
  });

  particles.forEach((p,i)=>{
    p.update(); p.draw();
    if(p.life<=0) particles.splice(i,1);
  });

  requestAnimationFrame(animate);
}
animate();

function startFireworks(){
  let count = 0;
  const interval = setInterval(()=>{
    fireworks.push(new Firework());
    count++;
    if (count > 8) clearInterval(interval); 
  },1500);
}

// ====== Popup ƒëi·ªÉm tuy·ªát ƒë·ªëi ======
function showPerfectPopup() {
  const popup = document.createElement("div");
  popup.className = "popup";
  popup.textContent = "üåü ƒê·∫†T ƒêI·ªÇM TUY·ªÜT ƒê·ªêI 35/35 üåü";
  document.body.appendChild(popup);
  setTimeout(() => popup.remove(), 7000);
}
</script>
</body>
</html>
